<h1>
  <span class='mr-1' style='color: <%= @repository.color %>;' title='<%= @repository.language %>'>
    <%= octicon(repo_icon(@repository), height: 36) %>
  </span>
  <%= link_to @repository.full_name, "https://github.com/#{@repository.full_name}", target: :_blank %>
</h1>

<p>
  <%= @repository.description %>
</p>

<p>
<small class='text-muted'>
  Language: <%= @repository.language %><br/>
  Last pushed: <%= distance_of_time_in_words_to_now @repository.pushed_at %> ago<br/>
  Size: <%= number_to_human_size @repository.size*1000 %><br/>
  Dependencies: <%= number_with_delimiter @repository.dependencies.count %>
</small>
</p>

<% if @repository.manifests.any? %>
  <h5>
    Dependencies
  </h5>

  <% @repository.manifests.includes(repository_dependencies: {package: :versions}).order('kind DESC').each do |manifest| %>
    <div class="card mb-3">
      <div class="card-header">
        <%= manifest.filepath %>
      </div>
      <ul class="list-group list-group-flush">
        <% manifest.repository_dependencies.sort_by(&:package_name).each do |dependency| %>
          <li class="list-group-item">
            <% if dependency.package %>
              <%= link_to dependency.package_name, package_url(dependency.package.id) %>
            <% else %>
              <%= dependency.package_name %>
            <% end %>
            <%= dependency.requirements %>
            <small class='text-muted'>
            <% if dependency.kind != 'runtime' %>
              <%= dependency.kind %>
            <% end %>
            <% if dependency.optional %>
              (optional)
            <% end %>
            </small>
            <% if dependency.outdated? %>
              <% if dependency.latest_resolvable_version && dependency.latest_resolvable_version.semantic_version.major < dependency.package.latest_stable_release.semantic_version.major %>
                <span class='badge badge-danger' title='Latest stable version is <%= dependency.package.latest_stable_release_number %>' >Outdated</span>
              <% else %>
                <span class='badge badge-warning' title='Latest stable version is <%= dependency.package.latest_stable_release_number %>' >Outdated</span>
              <% end %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

<% end %>
