<% @page_title = @repository.full_name %>
<h1>
  <span class='mr-1' style='color: <%= @repository.color %>;' title='<%= @repository.language %>'>
    <%= octicon(repo_icon(@repository), height: 36) %>
  </span>
  <%= link_to @repository.full_name, "https://github.com/#{@repository.full_name}", target: :_blank %>
</h1>

<p>
  <%= @repository.description %>
</p>

<div class="row">
  <div class="col-md-4">
    <p><small class='text-muted'>
      Ecosystem Score: <%= @repository.score %><br/>
      Stars: <%= number_with_delimiter @repository.stargazers_count %><br/>
      Forks: <%= number_with_delimiter @repository.forks_count %><br/>
      Open Issues: <%= number_with_delimiter @repository.open_issues_count %><br/>
      Watchers: <%= number_with_delimiter @repository.subscribers_count %><br/>
    </small></p>
  </div>
  <div class="col-md-4">
    <p><small class='text-muted'>
      Language: <%= @repository.language %><br/>
      Repo Size: <%= number_to_human_size @repository.size*1000 %><br/>
      Direct internal dependencies: <%= number_with_delimiter @repository.direct_internal_dependency_package_ids.length %><br/>
      Indirect internal dependencies: <%= number_with_delimiter @repository.direct_internal_dependency_package_ids.length %><br/>
      Total Dependencies: <%= number_with_delimiter @manifests.map(&:repository_dependencies).flatten.length %><br/>
    </small></p>
  </div>
  <div class="col-md-4">
    <p><small class='text-muted'>
      Created: <%= distance_of_time_in_words_to_now @repository.created_at %> ago<br/>
      Updated: <%= distance_of_time_in_words_to_now @repository.updated_at %> ago<br/>
      Last pushed: <%= distance_of_time_in_words_to_now @repository.pushed_at %> ago<br/>
      Last synced: <%= distance_of_time_in_words_to_now @repository.last_sync_at %> ago
    </small></p>
  </div>
</div>

<p>
<small class='text-muted'>



</small>
</p>

<ul class="nav nav-tabs mb-3">
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:tab].blank? || params[:tab] == 'search' %>" href="<%= url_for(request.params.merge(tab: 'search')) %>">
      Search results
      <span class='badge badge-secondary'><%= @results.count %></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:tab] == 'packages' %>" href="<%= url_for(request.params.merge(tab: 'packages')) %>">
      Packages
      <span class='badge badge-secondary'><%= @repository.packages.count %></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:tab] == 'dependencies' %>" href="<%= url_for(request.params.merge(tab: 'dependencies')) %>">
      Dependencies
      <span class='badge badge-secondary'><%= @repository.repository_dependencies.length %></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:tab] == 'internal_direct' %>" href="<%= url_for(request.params.merge(tab: 'internal_direct')) %>">
      Internal Direct Dependencies
      <span class='badge badge-secondary'><%= @repository.direct_internal_dependency_package_ids.length %></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link <%= 'active' if params[:tab] == 'internal_indirect' %>" href="<%= url_for(request.params.merge(tab: 'internal_indirect')) %>">
      Internal Indirect Dependencies
      <span class='badge badge-secondary'><%= @repository.indirect_internal_dependency_package_ids.length %></span>
    </a>
  </li>
</ul>

<%= case params[:tab]
when 'dependencies'
  render 'dependencies'
when 'packages'
  render 'packages'
when 'internal_direct'
  render 'internal_direct'
when 'internal_indirect'
  render 'internal_indirect'
else
  render 'search'
end %>
